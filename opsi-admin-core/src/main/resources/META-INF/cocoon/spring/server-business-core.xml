<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:util="http://www.springframework.org/schema/util"
	xmlns:p="http://www.springframework.org/schema/p"
	xsi:schemaLocation="
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd
        ">

	<context:component-scan base-package="cz.u2.eis.business.core" />


	<bean id="businessMapper" class="org.dozer.spring.DozerBeanMapperFactoryBean">
		<qualifier value="business" />
		<property name="mappingFiles">
			<list>
				<value>classpath:/cz/u2/eis/business/core/dozer/User-mapping.xml</value>
				<value>classpath:/cz/u2/eis/business/core/dozer/Task-mapping.xml</value>
			</list>
		</property>
		<property name="customConvertersWithId">
			<map>
				<entry key="stubConverter" value-ref="hibernateStubDozerConverter" />
			</map>
		</property>
	</bean>

	<bean id="hibernateStubDozerConverter" class="cz.u2.eis.valueObjects.HibernateStubDozerConverter">
		<property name="sessionFactory" ref="businessSessionFactory" />
		<property name="mapperRefId">
			<idref bean="businessMapper" />
		</property>
	</bean>

	<bean id="taskFlowDescriptor" class="cz.u2.eis.flow.core.DefaultFlowDescriptor">
		<property name="id"><util:constant static-field="cz.u2.eis.business.core.task.TaskServiceImpl.FLOW_TASK_ID"/></property>
		<property name="beanClass" value="cz.u2.eis.business.api.task.Task"/>
		<property name="flowStates">
			<list>
				<ref bean="task.NEW"/>
				<ref bean="task.ACCEPTED"/>
				<ref bean="task.VALIDATE"/>
				<ref bean="task.CLOSED"/>
			</list>
		</property>
		<property name="startFlowState" ref="task.NEW"/>
		<property name="cislovaniPrefix" value="TASK-"/>
	</bean>

	<bean id="task.NEW" class="cz.u2.eis.flow.core.DefaultFlowState">
		<property name="id" value="NEW"/>
		<property name="startState" value="true"/>
		<property name="transitions">
			<list>
				<bean class="cz.u2.eis.flow.core.DefaultFlowTransition"
					p:id="accept" p:state-ref="task.ACCEPTED" />
				<bean class="cz.u2.eis.flow.core.DefaultFlowTransition"
					p:id="reject" p:state-ref="task.VALIDATE" />
			</list>
		</property>
	</bean>
	<bean id="task.ACCEPTED" class="cz.u2.eis.flow.core.DefaultFlowState">
		<property name="id" value="ACCEPTED"/>
		<property name="transitions">
			<list>
				<bean class="cz.u2.eis.flow.core.DefaultFlowTransition"
					p:id="finish" p:state-ref="task.VALIDATE" />
				<bean class="cz.u2.eis.flow.core.DefaultFlowTransition"
					p:id="forward" p:state-ref="task.NEW" />
			</list>
		</property>
	</bean>
	<bean id="task.VALIDATE" class="cz.u2.eis.flow.core.DefaultFlowState">
		<property name="id" value="VALIDATE"/>
		<property name="transitions">
			<list>
				<bean class="cz.u2.eis.flow.core.DefaultFlowTransition"
					p:id="failed" p:state-ref="task.NEW" />
				<bean class="cz.u2.eis.flow.core.DefaultFlowTransition"
					p:id="close" p:state-ref="task.CLOSED" />
			</list>
		</property>
	</bean>
	<bean id="task.CLOSED" class="cz.u2.eis.flow.core.DefaultFlowState">
		<property name="id" value="CLOSED"/>
		<property name="endState" value="true"/>
	</bean>

</beans>
